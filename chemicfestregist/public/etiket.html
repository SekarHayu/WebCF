<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ticket Chemicfest#9</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.iconify.design/iconify-icon/2.0.0/iconify-icon.min.js"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              white: "#f1f5f9",
              "white-1": "#cbd5e1",
              dark: "#1e2124",
              "dark-1": "#282b30",
            },
            fontFamily: {
              signika: ["Signika", "sans-serif"],
            },
          },
        },
      };
    </script>
    <style type="text/tailwindcss">
      @font-face {
        font-family: "Signika";
        src: url("../public/fonts/Signika-VariableFont_GRAD,wght.ttf");
      }

      
      @media print {
        body {
          margin: 0;
        }

        .no-print {
          display: none;
        }

        /* Enable background graphics */
        html {
          -webkit-print-color-adjust: exact !important;
          print-color-adjust: exact !important;
        }

        /* Disable headers and footers */
        @page {
          size: auto;
          margin: 0;
        }
      }
    </style>
  </head>
  <body class="font-signika h-full">
    <!--Header-->
    <div class="flex bg-dark p-6" style="background-image: url(pattern.png); background-size: cover;">
      <div class="mx-2 sm:mx-10 flex w-full">
        <img src="/image/chemicfest9_maskot.png" class="w-16 sm:w-20" alt="CF Logo">
        <p class="pt-10 ms-auto text-white">E-Ticket</p>
      </div>
    </div>

    <!--Informasi Acara-->
    <div class="text-5xl font-bold mt-5 mx-5 sm:mx-20">
      <div class="flex flex-col border-2 p-4 rounded-xl">
        <h5 class="text-2xl">Chemicfest #9</h5>
        <div class="flex flex-col sm:flex-row mt-4 gap-7">
          <div class="w-full sm:w-1/3">
            <!--Poster-->
            <img class="rounded-lg" src="/image/event.jpeg"  alt="">
          </div>
          <div class="flex flex-col my-auto w-full sm:w-2/3 gap-2">
            <div class="flex flex-row gap-3 w-full">
              <iconify-icon class="my-auto text-dark md:w-fit" width="28" icon="heroicons-solid:badge-check" ></iconify-icon>
              <p class="my-auto text-base lg:text-lg text-dark  font-semibold">OSIS SMK SMTI Yogyakarta</p>
            </div>
            <div class="flex flex-row gap-3 w-full">
              <iconify-icon class="my-auto text-dark md:w-fit" width="28" icon="uil:schedule" ></iconify-icon>
              <p class="my-auto text-base lg:text-lg text-dark  font-normal">17 Mei 2025</p><br>
            </div>
            <div class="flex flex-row gap-3 w-full">
              <iconify-icon class="my-auto text-dark  md:w-fit" width="28" icon="carbon:location-filled" ></iconify-icon>
              <p class="my-auto text-base lg:text-lg text-dark font-normal">GOR UMY, Jl. Brawijaya, Ngebel, Tamantirto, Kec. Kasihan, Kabupaten Bantul, Daerah Istimewa Yogyakarta 55183, Indonesia</p>
            </div>
          </div>
        </div>
      </div>

      <!--Informasi Pesanan-->
      <div class="flex flex-col mt-5 gap-4">
        <h5 class="text-xl">Informasi Pesanan</h5>
        <div class="flex flex-col sm:flex-row gap-2">
          <div class="flex flex-col w-full sm:w-2/3 border-2 rounded-xl p-4 gap-2">
            <div class="flex flex-row gap-3 w-full">
              <p class="my-auto text-base text-dark w-1/3 font-normal">Kode Pesanan</p>
              <p class="my-auto text-base text-dark w-2/3 font-semibold">(booking code)</p>
            </div>

            <!--Nama Pemesan-->
            <div class="flex flex-row gap-3 w-full">
              <p class="my-auto text-base text-dark w-1/3 font-normal">Nama Pemesan</p>
              <p class="my-auto text-base text-dark w-2/3 font-semibold">(email aja)</p>
            </div>
            <div class="flex flex-row gap-3 w-full">
              <p class="my-auto text-base text-dark w-1/3 font-normal">Berlaku Untuk</p>
              <p class="my-auto text-base text-dark w-2/3 font-semibold">1 Pax (jumlah tiket)</p>
            </div>
            <div class="flex flex-row gap-3 w-full">
              <p class="my-auto text-base text-dark w-1/3 font-normal">Validitas Voucher</p>
              <p class="my-auto text-base text-dark w-2/3 font-semibold">17 Mei 2025</p>
            </div>
          </div>

          <div class="flex flex-col w-full sm:w-1/3 border-2 rounded-xl p-4 gap-2 mx-auto text-center">
            <p class="font-bold text-lg">IDR 40.000</p>
            <img src="https://qrcg-free-editor.qr-code-generator.com/main/assets/images/websiteQRCode_noFrame.png" class="w-1/2 mx-auto" alt="">
            <p class="font-light text-sm">Dibuat pada 17 Agustus 1945</p>
          </div>
        </div>
      </div>

      <!--Syarat dan Ketentuan-->
      <div class="flex flex-col mt-5 gap-4 pb-4">
        <h5 class="text-xl">Syarat dan Ketentuan</h5>
        <p class="leading-loose text-base font-normal">
          
          - Maks. pembelian 2 tiket per akun/ID per show day. <br>
          - Wajib login ke akun chemicfest9.site untuk melakukan pembelian. <br>
       
        </p>
      </div>

    </div>
  </body>
</html>

<script>
    async function fetchTicketData() {
      try {
        const userData = JSON.parse(sessionStorage.getItem("userData"));
        const userId = userData?.userId;
        
        if (!userId) {
          console.error("User ID tidak ditemukan.");
          document.getElementById("errorMessage").innerText = "User ID tidak ditemukan. Silakan login kembali.";
          return;
        }
  
        const response = await fetch("http://192.168.189.4:2025/api/have-ticket", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ userId }),
        });
  
        const result = await response.json();
  
        if (result.code === 200 && result.data.length > 0) {
          const ticket = result.data[0]; // Ambil transaksi pertama
  
          document.getElementById("kodePesanan").innerText = ticket.bookingCode || "-";
          document.getElementById("namaPemesan").innerText = ticket.type ;
          document.getElementById("jumlahTiket").innerText = ticket.needed ;
  
          if (ticket.ticketUrls.length > 0) {
            document.getElementById("qrCode").src = ticket.ticketUrls[0];
            document.getElementById("qrCode").style.display = "block";
          } else {
            document.getElementById("qrCode").style.display = "none";
          }
  
        } else {
          document.getElementById("kodePesanan").innerText = "-";
          document.getElementById("namaPemesan").innerText = "-";
          document.getElementById("jumlahTiket").innerText = "-";
          document.getElementById("qrCode").style.display = "none";
          document.getElementById("errorMessage").innerText = "Anda belum memiliki tiket.";
        }
      } catch (error) {
        console.error("Error fetching ticket data:", error);
        document.getElementById("errorMessage").innerText = "Terjadi kesalahan saat mengambil data tiket.";
      }
    }
  
    // Panggil saat halaman dimuat
    window.onload = fetchTicketData;
  </script>
  
